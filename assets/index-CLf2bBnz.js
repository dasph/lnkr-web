import{g as _,i as N,c as f,a as w,t as R,d as J,b as k,e as T,f as W,r as D,s as K,u as ee,h as $,j as q}from"./index-po46MIuh.js";const te="_module_1xos1_1",ne={module:te};var ae=R("<div>");const ie=({children:e})=>(()=>{var t=_(ae);return N(t,e),f(()=>w(t,ne.module)),t})();function m(e){const t=new Uint8Array(e);let n="";for(const r of t)n+=String.fromCharCode(r);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function U(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=(4-t.length%4)%4,a=t.padEnd(t.length+n,"="),r=atob(a),l=new ArrayBuffer(r.length),o=new Uint8Array(l);for(let s=0;s<r.length;s++)o[s]=r.charCodeAt(s);return l}function B(){return window?.PublicKeyCredential!==void 0&&typeof window.PublicKeyCredential=="function"}function G(e){const{id:t}=e;return{...e,id:U(t),transports:e.transports}}function V(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class c extends Error{constructor({message:t,code:n,cause:a,name:r}){super(t,{cause:a}),this.name=r??a.name,this.code=n}}function re({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new c({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(n.authenticatorSelection?.requireResidentKey===!0)return new c({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(n.authenticatorSelection?.userVerification==="required")return new c({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new c({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new c({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return n.pubKeyCredParams.filter(r=>r.type==="public-key").length===0?new c({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new c({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const a=window.location.hostname;if(V(a)){if(n.rp.id!==a)return new c({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new c({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new c({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new c({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}class oe{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Y=new oe,se=["cross-platform","platform"];function j(e){if(e&&!(se.indexOf(e)<0))return e}async function le(e){if(!B())throw new Error("WebAuthn is not supported in this browser");const n={publicKey:{...e,challenge:U(e.challenge),user:{...e.user,id:U(e.user.id)},excludeCredentials:e.excludeCredentials?.map(G)}};n.signal=Y.createNewAbortSignal();let a;try{a=await navigator.credentials.create(n)}catch(g){throw re({error:g,options:n})}if(!a)throw new Error("Registration was not completed");const{id:r,rawId:l,response:o,type:s}=a;let h;typeof o.getTransports=="function"&&(h=o.getTransports());let p;if(typeof o.getPublicKeyAlgorithm=="function")try{p=o.getPublicKeyAlgorithm()}catch(g){H("getPublicKeyAlgorithm()",g)}let y;if(typeof o.getPublicKey=="function")try{const g=o.getPublicKey();g!==null&&(y=m(g))}catch(g){H("getPublicKey()",g)}let E;if(typeof o.getAuthenticatorData=="function")try{E=m(o.getAuthenticatorData())}catch(g){H("getAuthenticatorData()",g)}return{id:r,rawId:m(l),response:{attestationObject:m(o.attestationObject),clientDataJSON:m(o.clientDataJSON),transports:h,publicKeyAlgorithm:p,publicKey:y,authenticatorData:E},type:s,clientExtensionResults:a.getClientExtensionResults(),authenticatorAttachment:j(a.authenticatorAttachment)}}function H(e,t){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,t)}function ce(){if(!B())return new Promise(t=>t(!1));const e=window.PublicKeyCredential;return e.isConditionalMediationAvailable===void 0?new Promise(t=>t(!1)):e.isConditionalMediationAvailable()}function ue({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new c({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new c({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const a=window.location.hostname;if(V(a)){if(n.rpId!==a)return new c({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new c({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new c({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function de(e,t=!1){if(!B())throw new Error("WebAuthn is not supported in this browser");let n;e.allowCredentials?.length!==0&&(n=e.allowCredentials?.map(G));const a={...e,challenge:U(e.challenge),allowCredentials:n},r={};if(t){if(!await ce())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');r.mediation="conditional",a.allowCredentials=[]}r.publicKey=a,r.signal=Y.createNewAbortSignal();let l;try{l=await navigator.credentials.get(r)}catch(E){throw ue({error:E,options:r})}if(!l)throw new Error("Authentication was not completed");const{id:o,rawId:s,response:h,type:p}=l;let y;return h.userHandle&&(y=m(h.userHandle)),{id:o,rawId:m(s),response:{authenticatorData:m(h.authenticatorData),clientDataJSON:m(h.clientDataJSON),signature:m(h.signature),userHandle:y},type:p,clientExtensionResults:l.getClientExtensionResults(),authenticatorAttachment:j(l.authenticatorAttachment)}}const he="_module_1dvah_1",ge="_signup_1dvah_6",pe="_divider_1dvah_11",fe="_signin_1dvah_30",me="_copy_1dvah_36",C={module:he,signup:ge,divider:pe,signin:fe,copy:me};var be=R("<section><!$><!/><!$><!/>"),_e=R('<input type=button value="Log out">'),we=R('<div><input type=text placeholder="your name"><input type=button value=Continue>'),Re=R("<div><span>or"),ye=R("<span>Already have an account? <a href=#>Log In"),Ee=R("<div><input type=text placeholder=url><input type=button value=Submit>"),Ae=R("<span>");const ve=e=>{const[t,n]=ee,[a,r]=k(""),[l,o]=k(""),[s,h]=k(""),p=T(()=>btoa(encodeURIComponent(a()))),y=T(()=>s()?`https://lndb.cc/${s()}`:""),E=T(()=>{try{const{protocol:d}=new URL(l());return["http:","https:"].includes(d)}catch{return!1}}),g=async d=>{const{key:S,payload:v}=await $("auth/signup","get",{name:d}),I=await le(v);await $("auth/signup","post",{key:S,payload:I}).catch(()=>{}).then(x=>n(!!x))},z=async()=>{const{key:d,payload:S}=await $("auth/signin","get",{}),v=await de(S);await $("auth/signin","post",{key:d,payload:v}).catch(()=>{}).then(I=>n(!!I))},F=()=>$("auth/signout","get",{}).then(()=>n(!1)),Q=async()=>{const{alias:d}=await $("link","post",{tags:[],value:l()}).catch(()=>({alias:""}));o(""),h(d)};return(()=>{var d=_(be),S=d.firstChild,[v,I]=W(S.nextSibling),x=v.nextSibling,[X,Z]=W(x.nextSibling);return N(d,(()=>{var L=T(()=>!!t());return()=>L()?(()=>{var i=_(_e);return i.$$click=F,D(),i})():[(()=>{var i=_(we),b=i.firstChild,A=b.nextSibling;return b.$$input=({target:{value:u}})=>r(u),A.$$click=()=>g(p()),f(u=>{var P=C.signup,O=p().length>64;return P!==u.e&&w(i,u.e=P),O!==u.t&&K(A,"disabled",u.t=O),u},{e:void 0,t:void 0}),f(()=>K(b,"value",a())),D(),i})(),(()=>{var i=_(Re);return f(()=>w(i,C.divider)),i})(),(()=>{var i=_(ye),b=i.firstChild,A=b.nextSibling;return A.$$click=z,f(()=>w(i,C.signin)),D(),i})()]})(),v,I),N(d,(()=>{var L=T(()=>!!t());return()=>L()&&[(()=>{var i=_(Ee),b=i.firstChild,A=b.nextSibling;return b.$$input=({target:{value:u}})=>o(u),A.$$click=Q,f(u=>{var P=C.signup,O=!E();return P!==u.e&&w(i,u.e=P),O!==u.t&&K(A,"disabled",u.t=O),u},{e:void 0,t:void 0}),f(()=>K(b,"value",l())),D(),i})(),(()=>{var i=_(Ae);return i.$$click=()=>navigator.clipboard.writeText(y()),N(i,y),f(()=>w(i,C.copy)),D(),i})()]})(),X,Z),f(()=>w(d,`${C.module} ${e.className||""}`)),d})()};J(["click","input"]);const $e="_module_4tqgj_1",Ce="_home_4tqgj_7",Se="_auth_4tqgj_15",M={module:$e,home:Ce,auth:Se};var Ie=R("<main><section><h1>Welcome to lndb.cc</h1><span>Get started - it's free. No credit card needed.</span><!$><!/>");const Oe=()=>q(ie,{get children(){var e=_(Ie),t=e.firstChild,n=t.firstChild,a=n.nextSibling,r=a.nextSibling,[l,o]=W(r.nextSibling);return N(t,q(ve,{get className(){return M.auth}}),l,o),f(s=>{var h=M.module,p=M.home;return h!==s.e&&w(e,s.e=h),p!==s.t&&w(t,s.t=p),s},{e:void 0,t:void 0}),e}});export{Oe as default};
