import{g as _,i as N,c as f,a as w,t as R,d as Z,b as k,e as T,f as W,r as D,s as K,h as $,u as J,j as q}from"./index-D00lxlfI.js";const ee="_module_1xos1_1",te={module:ee};var ne=R("<div>");const ae=({children:e})=>(()=>{var t=_(ne);return N(t,e),f(()=>w(t,te.module)),t})();function m(e){const t=new Uint8Array(e);let n="";for(const r of t)n+=String.fromCharCode(r);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function U(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=(4-t.length%4)%4,a=t.padEnd(t.length+n,"="),r=atob(a),c=new ArrayBuffer(r.length),o=new Uint8Array(c);for(let s=0;s<r.length;s++)o[s]=r.charCodeAt(s);return c}function B(){return window?.PublicKeyCredential!==void 0&&typeof window.PublicKeyCredential=="function"}function G(e){const{id:t}=e;return{...e,id:U(t),transports:e.transports}}function V(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class u extends Error{constructor({message:t,code:n,cause:a,name:r}){super(t,{cause:a}),this.name=r??a.name,this.code=n}}function ie({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new u({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(n.authenticatorSelection?.requireResidentKey===!0)return new u({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(n.authenticatorSelection?.userVerification==="required")return new u({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new u({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new u({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return n.pubKeyCredParams.filter(r=>r.type==="public-key").length===0?new u({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new u({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const a=window.location.hostname;if(V(a)){if(n.rp.id!==a)return new u({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new u({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new u({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new u({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}class re{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Y=new re,oe=["cross-platform","platform"];function j(e){if(e&&!(oe.indexOf(e)<0))return e}async function se(e){if(!B())throw new Error("WebAuthn is not supported in this browser");const n={publicKey:{...e,challenge:U(e.challenge),user:{...e.user,id:U(e.user.id)},excludeCredentials:e.excludeCredentials?.map(G)}};n.signal=Y.createNewAbortSignal();let a;try{a=await navigator.credentials.create(n)}catch(h){throw ie({error:h,options:n})}if(!a)throw new Error("Registration was not completed");const{id:r,rawId:c,response:o,type:s}=a;let d;typeof o.getTransports=="function"&&(d=o.getTransports());let p;if(typeof o.getPublicKeyAlgorithm=="function")try{p=o.getPublicKeyAlgorithm()}catch(h){H("getPublicKeyAlgorithm()",h)}let E;if(typeof o.getPublicKey=="function")try{const h=o.getPublicKey();h!==null&&(E=m(h))}catch(h){H("getPublicKey()",h)}let y;if(typeof o.getAuthenticatorData=="function")try{y=m(o.getAuthenticatorData())}catch(h){H("getAuthenticatorData()",h)}return{id:r,rawId:m(c),response:{attestationObject:m(o.attestationObject),clientDataJSON:m(o.clientDataJSON),transports:d,publicKeyAlgorithm:p,publicKey:E,authenticatorData:y},type:s,clientExtensionResults:a.getClientExtensionResults(),authenticatorAttachment:j(a.authenticatorAttachment)}}function H(e,t){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,t)}function le(){if(!B())return new Promise(t=>t(!1));const e=window.PublicKeyCredential;return e.isConditionalMediationAvailable===void 0?new Promise(t=>t(!1)):e.isConditionalMediationAvailable()}function ce({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new u({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new u({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const a=window.location.hostname;if(V(a)){if(n.rpId!==a)return new u({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new u({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new u({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function ue(e,t=!1){if(!B())throw new Error("WebAuthn is not supported in this browser");let n;e.allowCredentials?.length!==0&&(n=e.allowCredentials?.map(G));const a={...e,challenge:U(e.challenge),allowCredentials:n},r={};if(t){if(!await le())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');r.mediation="conditional",a.allowCredentials=[]}r.publicKey=a,r.signal=Y.createNewAbortSignal();let c;try{c=await navigator.credentials.get(r)}catch(y){throw ce({error:y,options:r})}if(!c)throw new Error("Authentication was not completed");const{id:o,rawId:s,response:d,type:p}=c;let E;return d.userHandle&&(E=m(d.userHandle)),{id:o,rawId:m(s),response:{authenticatorData:m(d.authenticatorData),clientDataJSON:m(d.clientDataJSON),signature:m(d.signature),userHandle:E},type:p,clientExtensionResults:c.getClientExtensionResults(),authenticatorAttachment:j(c.authenticatorAttachment)}}const de="_module_1dvah_1",he="_signup_1dvah_6",ge="_divider_1dvah_11",pe="_signin_1dvah_30",fe="_copy_1dvah_36",C={module:de,signup:he,divider:ge,signin:pe,copy:fe};var me=R("<section><!$><!/><!$><!/>"),be=R('<input type=button value="Log out">'),_e=R('<div><input type=text placeholder="your name"><input type=button value=Continue>'),we=R("<div><span>or"),Re=R("<span>Already have an account? <a href=#>Log In"),Ee=R("<div><input type=text placeholder=url><input type=button value=Continue>"),ye=R("<span>");const Ae=e=>{const[t,n]=J,[a,r]=k(""),[c,o]=k(""),[s,d]=k(""),p=T(()=>btoa(encodeURIComponent(a()))),E=T(()=>s()?`https://lndb.cc/${s()}`:""),y=T(()=>{try{const{protocol:g}=new URL(c());return["http:","https:"].includes(g)}catch{return!1}}),h=async g=>{const{key:I,payload:v}=await $("auth/signup","get",{name:g}),S=await se(v);await $("auth/signup","post",{key:I,payload:S}).catch(()=>{}).then(x=>n(!!x))},z=async()=>{const{key:g,payload:I}=await $("auth/signin","get",{}),v=await ue(I);await $("auth/signin","post",{key:g,payload:v}).catch(()=>{}).then(S=>n(!!S))},F=()=>$("auth/signout","get",{}).then(()=>n(!1));return(()=>{var g=_(me),I=g.firstChild,[v,S]=W(I.nextSibling),x=v.nextSibling,[Q,X]=W(x.nextSibling);return N(g,(()=>{var L=T(()=>!!t());return()=>L()?(()=>{var i=_(be);return i.$$click=F,D(),i})():[(()=>{var i=_(_e),b=i.firstChild,A=b.nextSibling;return b.$$input=({target:{value:l}})=>r(l),A.$$click=()=>h(p()),f(l=>{var P=C.signup,O=p().length>64;return P!==l.e&&w(i,l.e=P),O!==l.t&&K(A,"disabled",l.t=O),l},{e:void 0,t:void 0}),f(()=>K(b,"value",a())),D(),i})(),(()=>{var i=_(we);return f(()=>w(i,C.divider)),i})(),(()=>{var i=_(Re),b=i.firstChild,A=b.nextSibling;return A.$$click=z,f(()=>w(i,C.signin)),D(),i})()]})(),v,S),N(g,(()=>{var L=T(()=>!!t());return()=>L()&&[(()=>{var i=_(Ee),b=i.firstChild,A=b.nextSibling;return b.$$input=({target:{value:l}})=>o(l),A.$$click=()=>$("","post",{tags:[],value:c()}).catch(()=>({alias:""})).then(({alias:l})=>d(l)),f(l=>{var P=C.signup,O=!y();return P!==l.e&&w(i,l.e=P),O!==l.t&&K(A,"disabled",l.t=O),l},{e:void 0,t:void 0}),f(()=>K(b,"value",c())),D(),i})(),(()=>{var i=_(ye);return i.$$click=()=>navigator.clipboard.writeText(E()),N(i,E),f(()=>w(i,C.copy)),D(),i})()]})(),Q,X),f(()=>w(g,`${C.module} ${e.className||""}`)),g})()};Z(["click","input"]);const ve="_module_4tqgj_1",$e="_home_4tqgj_7",Ce="_auth_4tqgj_15",M={module:ve,home:$e,auth:Ce};var Ie=R("<main><section><h1>Welcome to lndb.cc</h1><span>Get started - it's free. No credit card needed.</span><!$><!/>");const Pe=()=>q(ae,{get children(){var e=_(Ie),t=e.firstChild,n=t.firstChild,a=n.nextSibling,r=a.nextSibling,[c,o]=W(r.nextSibling);return N(t,q(Ae,{get className(){return M.auth}}),c,o),f(s=>{var d=M.module,p=M.home;return d!==s.e&&w(e,s.e=d),p!==s.t&&w(t,s.t=p),s},{e:void 0,t:void 0}),e}});export{Pe as default};
